<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>ğŸ”§ Ù…Ø­Ø±Ø± Ø£Ø±Ø¯ÙˆÙŠÙ†Ùˆ Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Ù…ÙƒØªØ¨Ø© CodeMirror -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/clike/clike.min.js"></script>
  <style>
    body{margin:0;font-family:"Cairo",sans-serif;background:#0f172a;color:#e5e7eb}
    header{background:linear-gradient(90deg,#0ea5e9,#22c55e);padding:12px;color:#08101a;font-weight:900;display:flex;justify-content:space-between;align-items:center}
    .toolbar{background:#0b1220;padding:8px;display:flex;gap:8px;flex-wrap:wrap}
    .btn{padding:8px 12px;border:none;border-radius:6px;cursor:pointer;font-weight:700}
    .btn.verify{background:#0ea5e9;color:#08101a}
    .btn.upload{background:#22c55e;color:#08101a}
    .btn.save{background:#1f2937;color:#e5e7eb}
    #editor{height:50vh;border:1px solid #1f2937}
    #console{background:#091021;color:#0ea5e9;height:20vh;overflow:auto;padding:8px;font-family:monospace}
    #errors{padding:8px;font-weight:bold}
  </style>
</head>
<body>
  <header>
    <div>ğŸ”§ Ù…Ø­Ø±Ø± Ø£Ø±Ø¯ÙˆÙŠÙ†Ùˆ Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ</div>
    <div>ÙˆØ§Ø¬Ù‡Ø© Ø´Ø¨ÙŠÙ‡Ø© Ø¨Ù€ Arduino IDE</div>
  </header>

  <div class="toolbar">
    <button class="btn verify" onclick="verifyCode()">âœ”ï¸ Verify</button>
    <button class="btn upload" onclick="uploadCode()">â¬†ï¸ Upload</button>
    <button class="btn upload" onclick="openSerial()">ğŸ”Œ ÙØªØ­ Ø§Ù„Ù…Ù†ÙØ°</button>
    <button class="btn upload" onclick="sendSerial()">â¡ï¸ Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø£Ø±Ø¯ÙˆÙŠÙ†Ùˆ</button>
    <button class="btn save" onclick="saveCode()">ğŸ’¾ Save</button>
    <input id="serialInput" placeholder="Ø§ÙƒØªØ¨ Ø£Ù…Ø± ÙˆØ£Ø±Ø³Ù„Ù‡ Ù„Ù„Ù€ Arduino" style="flex:1;padding:6px;border-radius:6px;border:none">
  </div>

  <textarea id="editor">// Ù…Ø«Ø§Ù„ ÙƒÙˆØ¯ Ø£Ø±Ø¯ÙˆÙŠÙ†Ùˆ
void setup(){
  pinMode(13,OUTPUT);
}
void loop(){
  digitalWrite(13,HIGH);
  delay(1000);
  digitalWrite(13,LOW);
  delay(1000);
}</textarea>

  <div id="errors"></div>
  <div id="console">ğŸ’» Serial Monitor Ø¬Ø§Ù‡Ø²...</div>

<script>
  // ØªÙØ¹ÙŠÙ„ CodeMirror
  var editor = CodeMirror.fromTextArea(document.getElementById("editor"), {
    lineNumbers: true,
    mode: "text/x-c++src",
    theme: "default"
  });

  function log(msg,color="inherit"){
    const c = document.getElementById("console");
    c.innerHTML += `<div style="color:${color}">${msg}</div>`;
    c.scrollTop = c.scrollHeight;
  }

  // ÙØ­Øµ ÙˆØªØ­Ù„ÙŠÙ„ Ù…ØªÙ‚Ø¯Ù… Ù„Ù„ÙƒÙˆØ¯
  function verifyCode(){
    const code = editor.getValue();
    let errors = [];

    if(!code.includes("void setup")) errors.push("âŒ Ø§Ù„ÙƒÙˆØ¯ Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¯Ø§Ù„Ø© setup()");
    if(!code.includes("void loop")) errors.push("âŒ Ø§Ù„ÙƒÙˆØ¯ Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¯Ø§Ù„Ø© loop()");

    let openBraces = (code.match(/{/g)||[]).length;
    let closeBraces = (code.match(/}/g)||[]).length;
    if(openBraces !== closeBraces) errors.push("âŒ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù‚ÙˆØ§Ø³ { } ØºÙŠØ± Ù…ØªØ³Ø§ÙˆÙŠ");

    // ÙØ­Øµ Ø£ÙˆØ§Ù…Ø± Ø´Ø§Ø¦Ø¹Ø©
    if(code.includes("digitalWrite") && !code.includes("pinMode"))
      errors.push("âš ï¸ Ø§Ø³ØªØ®Ø¯Ù…Øª digitalWrite Ø¨Ø¯ÙˆÙ† ØªØ¹Ø±ÙŠÙ pinMode");

    if(code.includes("delay(") && !code.includes(";"))
      errors.push("âŒ Ø£Ù…Ø± delay ÙŠØ­ØªØ§Ø¬ ; ÙÙŠ Ø§Ù„Ù†Ù‡Ø§ÙŠØ©");

    const errorBox = document.getElementById("errors");
    if(errors.length>0){
      errorBox.innerHTML = errors.join("<br>");
      errorBox.style.color = "red";
    } else {
      errorBox.innerHTML = "âœ… Ø§Ù„ÙƒÙˆØ¯ ØµØ­ÙŠØ­ØŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø®Ø·Ø§Ø¡ Ø£Ø³Ø§Ø³ÙŠØ©";
      errorBox.style.color = "lime";
    }
  }

  // WebSerial
  let port, reader;
  async function openSerial(){
    try {
      port = await navigator.serial.requestPort();
      await port.open({ baudRate: 9600 });
      log("âœ… ØªÙ… ÙØªØ­ Ø§Ù„Ù…Ù†ÙØ°","lime");
      listenToPort();
    } catch(e){
      log("âŒ Ø®Ø·Ø£ ÙÙŠ ÙØªØ­ Ø§Ù„Ù…Ù†ÙØ°: "+e,"red");
    }
  }

  async function listenToPort(){
    const decoder = new TextDecoderStream();
    port.readable.pipeTo(decoder.writable);
    reader = decoder.readable.getReader();
    while(true){
      const { value, done } = await reader.read();
      if(done) break;
      if(value) log("ğŸ“¥ "+value,"#0ea5e9");
    }
  }

  async function sendSerial(){
    if(!port){ log("âš ï¸ Ø§ÙØªØ­ Ø§Ù„Ù…Ù†ÙØ° Ø£ÙˆÙ„Ø§Ù‹","orange"); return; }
    const text = document.getElementById("serialInput").value;
    const encoder = new TextEncoder();
    const writer = port.writable.getWriter();
    await writer.write(encoder.encode(text+"\n"));
    writer.releaseLock();
    log("â¡ï¸ Ø£ÙØ±Ø³Ù„: "+text,"lime");
  }

  function saveCode(){
    const blob = new Blob([editor.getValue()], {type:"text/plain"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "sketch.ino";
    a.click();
    URL.revokeObjectURL(a.href);
    log("ğŸ’¾ ØªÙ… Ø­ÙØ¸ Ø§Ù„ÙƒÙˆØ¯ ÙƒÙ…Ù„Ù sketch.ino","lime");
  }

  // Ø²Ø± Upload (placeholder Ù„Ù„ØªÙƒØ§Ù…Ù„ Ù…Ø¹ Agent/WebUSB)
  function uploadCode(){
    log("â¬†ï¸ Ø±ÙØ¹ Ø§Ù„ÙƒÙˆØ¯ ÙŠØªØ·Ù„Ø¨ Arduino Create Agent Ø£Ùˆ WebUSB Bootloader","orange");
  }
</script>
</body>
</html>
