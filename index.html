<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ù…Ø­ÙˆÙ„ Ø£ÙˆØ§Ù…Ø± Ø¹Ø±Ø¨ÙŠ â†’ ÙƒÙˆØ¯ Ø£Ø±Ø¯ÙˆÙŠÙ†Ùˆ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --bg:#0f172a; --card:#0b1220; --text:#e5e7eb; --muted:#94a3b8; --primary:#0ea5e9; --accent:#22c55e; --border:#1f2937; }
    *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font-family:"Cairo",system-ui}
    header{padding:14px 16px;background:linear-gradient(90deg,var(--primary),var(--accent));color:#08101a;font-weight:900}
    .container{max-width:1100px;margin:20px auto;padding:0 16px}
    .grid{display:grid;grid-template-columns:1fr 420px;gap:16px} @media(max-width:980px){.grid{grid-template-columns:1fr}}
    .card{background:var(--card);border:1px solid var(--border);border-radius:14px;overflow:hidden;box-shadow:0 8px 24px rgba(0,0,0,.35)}
    .card header{background:transparent;color:var(--text);padding:12px 16px;border-bottom:1px solid var(--border)}
    .card h2{margin:0;font-size:18px;color:var(--primary)}
    .card .body{padding:14px}
    textarea,.input{width:100%;background:#091021;color:var(--text);border:1px solid var(--border);border-radius:12px;padding:10px}
    textarea{min-height:120px;resize:vertical}
    .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-top:10px}
    .btn{padding:10px 12px;border-radius:10px;border:none;cursor:pointer;font-weight:800;color:#08101a;background:var(--primary)}
    .btn.accent{background:var(--accent)}
    .btn.muted{background:#1f2937;color:#cbd5e1}
    pre{background:#0a1324;border:1px solid #1f2937;border-radius:12px;padding:12px;overflow:auto;max-height:50vh}
    .example{padding:10px;border:1px solid var(--border);border-radius:12px;background:#091021;margin-bottom:8px}
    .title{font-weight:800;color:var(--primary)}
    .desc{font-size:12px;color:var(--muted)}
  </style>
</head>
<body>
  <header>ğŸ”§ Ù…Ø­ÙˆÙ„ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ø¥Ù„Ù‰ ÙƒÙˆØ¯ Ø£Ø±Ø¯ÙˆÙŠÙ†Ùˆ â€” Ù†Ø³Ø®Ø© MVP</header>

  <div class="container grid">
    <div class="card">
      <header><h2>Ø§ÙƒØªØ¨ Ø£Ù…Ø±Ùƒ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ</h2></header>
      <div class="body">
        <textarea id="arabic" placeholder="Ù…Ø«Ø§Ù„: Ø´ØºÙ„ Ø§Ù„Ù„ÙŠØ¯ ÙÙŠ Ø§Ù„Ø¨Ù† 13 Ù„Ù…Ø¯Ø© 2 Ø«Ø§Ù†ÙŠØ© ÙˆØ¨Ø¹Ø¯ÙŠÙ† Ø§Ù‚ÙÙ„Ù‡ØŒ ÙˆØ§Ø·Ø¨Ø¹ Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ±ÙŠØ§Ù„: ØªÙ… Ø§Ù„ØªØ´ØºÙŠÙ„"></textarea>
        <div class="row">
          <button class="btn" id="convert">ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ ÙƒÙˆØ¯</button>
          <button class="btn accent" id="copy">Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯</button>
          <button class="btn muted" id="download">ØªØ­Ù…ÙŠÙ„ .ino</button>
        </div>
        <div class="row">
          <input id="proj" class="input" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù (Ø¨Ø¯ÙˆÙ† Ø§Ù…ØªØ¯Ø§Ø¯) â€” Ù…Ø«Ø§Ù„: my_led_demo" />
        </div>
      </div>
    </div>

    <div class="card">
      <header><h2>Ø£Ù…Ø«Ù„Ø© Ø¬Ø§Ù‡Ø²Ø©</h2></header>
      <div class="body" id="examples">
        <div class="example">
          <div class="title">LED ØªØ´ØºÙŠÙ„/Ø¥Ø·ÙØ§Ø¡ + Ø³ÙŠØ±ÙŠØ§Ù„</div>
          <div class="desc">ÙŠØ´ØºÙ„ Ø§Ù„Ù„ÙŠØ¯ ÙÙŠ 13 Ù„Ù…Ø¯Ø© 2 Ø«Ø§Ù†ÙŠØ© Ø«Ù… ÙŠØ·ÙØ¦Ù‡ ÙˆÙŠØ·Ø¨Ø¹ Ø±Ø³Ø§Ù„Ø©</div>
          <button class="btn" onclick="loadExample('Ø´ØºÙ„ Ø§Ù„Ù„ÙŠØ¯ ÙÙŠ Ø§Ù„Ø¨Ù† 13 Ù„Ù…Ø¯Ø© 2 Ø«Ø§Ù†ÙŠØ© ÙˆØ¨Ø¹Ø¯ÙŠÙ† Ø§Ù‚ÙÙ„Ù‡ØŒ ÙˆØ§Ø·Ø¨Ø¹ Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ±ÙŠØ§Ù„: ØªÙ… Ø§Ù„ØªØ´ØºÙŠÙ„')">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø«Ø§Ù„</button>
        </div>
        <div class="example">
          <div class="title">PWM Ø³ÙŠØ±ÙÙˆ</div>
          <div class="desc">ØªØ¹ÙŠÙŠÙ† Ø²Ø§ÙˆÙŠØ© Ø§Ù„Ø³ÙŠØ±ÙÙˆ ÙÙŠ Ø§Ù„Ø¨Ù† 9 Ø¥Ù„Ù‰ 90 Ø¯Ø±Ø¬Ø©</div>
          <button class="btn" onclick="loadExample('Ø­Ø±Ùƒ Ø§Ù„Ø³ÙŠØ±ÙÙˆ ÙÙŠ Ø§Ù„Ø¨Ù† 9 Ø¥Ù„Ù‰ Ø²Ø§ÙˆÙŠØ© 90 Ø¯Ø±Ø¬Ø©ØŒ Ø«Ù… Ø¥Ù„Ù‰ 0 Ø¯Ø±Ø¬Ø© Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØ©')">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø«Ø§Ù„</button>
        </div>
        <div class="example">
          <div class="title">Ø­Ø³Ø§Ø³ ØªÙ†Ø§Ø¸Ø±ÙŠ</div>
          <div class="desc">Ù‚Ø±Ø§Ø¡Ø© A0 ÙˆØ·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© ÙƒÙ„ Ù†Øµ Ø«Ø§Ù†ÙŠØ©</div>
          <button class="btn" onclick="loadExample('Ø§Ù‚Ø±Ø£ Ø§Ù„Ø­Ø³Ø§Ø³ ÙÙŠ A0 ÙˆØ§Ø·Ø¨Ø¹ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ±ÙŠØ§Ù„ ÙƒÙ„ Ù†ØµÙ Ø«Ø§Ù†ÙŠØ©')">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø«Ø§Ù„</button>
        </div>
        <div class="example">
          <div class="title">PWM LED</div>
          <div class="desc">ØªØ­ÙƒÙ… ÙÙŠ Ø³Ø·ÙˆØ¹ LED ÙÙŠ Ø§Ù„Ø¨Ù† 5 Ø¥Ù„Ù‰ 128</div>
          <button class="btn" onclick="loadExample('Ø§Ø¶Ø¨Ø· Ø³Ø·ÙˆØ¹ Ø§Ù„Ù„ÙŠØ¯ ÙÙŠ Ø§Ù„Ø¨Ù† 5 Ø¥Ù„Ù‰ 128 Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… PWM')">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø«Ø§Ù„</button>
        </div>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="card">
      <header><h2>Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù†Ø§ØªØ¬</h2></header>
      <div class="body">
        <pre id="code">// Ø§Ù„ÙƒÙˆØ¯ Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­ÙˆÙŠÙ„</pre>
      </div>
    </div>
  </div>

  <script>
    // Utilities
    const arabicEl = document.getElementById('arabic');
    const codeEl = document.getElementById('code');
    const projEl = document.getElementById('proj');

    function loadExample(text){ arabicEl.value = text; }

    function normalize(s){
      return s.toLowerCase()
        .replace(/[Ø¡-ÙŠ]/g, c => c) // keep Arabic
        .replace(/[^\w\u0600-\u06FF\s]/g, ' ') // remove symbols
        .replace(/\s+/g, ' ')
        .trim();
    }

    // Rule-based intent extraction
    function parseIntent(text){
      const s = normalize(text);
      const intents = [];

      // LED on/off with pin and duration
      const pinMatch = s.match(/Ø§Ù„Ø¨Ù†\s*(\d+)/) || s.match(/pin\s*(\d+)/);
      const pin = pinMatch ? parseInt(pinMatch[1]) : null;

      if (s.includes('Ø´ØºÙ„') && (s.includes('Ù„ÙŠØ¯') || s.includes('Ø§Ù„Ù„ÙŠØ¯'))) {
        intents.push({type:'led', action:'on', pin: pin || 13});
      }
      if ((s.includes('Ø§Ù‚ÙÙ„')||s.includes('Ø§Ø·ÙÙŠ')||s.includes('Ø·ÙÙ‘ÙŠ')) && (s.includes('Ù„ÙŠØ¯')||s.includes('Ø§Ù„Ù„ÙŠØ¯'))) {
        intents.push({type:'led', action:'off', pin: pin || 13});
      }

      // delay
      const secMatch = s.match(/(?:Ø«Ø§Ù†ÙŠØ©|Ø«ÙˆØ§Ù†ÙŠ|Ø«Ø§Ù†ÙŠÙ‡)\s*(\d+)|Ù…Ø¯Ø©\s*(\d+)\s*Ø«Ø§Ù†ÙŠØ©/);
      const msMatch = s.match(/Ù…Ù„Ù„ÙŠ\s*Ø«Ø§Ù†ÙŠØ©\s*(\d+)/);
      if (secMatch) intents.push({type:'delay', ms: parseInt(secMatch[1] || secMatch[2]) * 1000});
      if (msMatch) intents.push({type:'delay', ms: parseInt(msMatch[1])});

      // serial print
      const serialMatch = text.match(/Ø§Ù„Ø³ÙŠØ±ÙŠØ§Ù„[:ï¼š]\s*(.+)$/i) || text.match(/Ø§Ø·Ø¨Ø¹\s*[:ï¼š]\s*(.+)$/i);
      if (serialMatch) intents.push({type:'serial', msg: serialMatch[1].trim()});

      // analog read
      const aPinMatch = s.match(/a(\d+)/);
      if (s.includes('Ø§Ù‚Ø±Ø£') && (s.includes('Ø­Ø³Ø§Ø³') || s.includes('analog'))) {
        intents.push({type:'analog', pin: aPinMatch ? ('A' + aPinMatch[1]) : 'A0', interval: (secMatch? parseInt(secMatch[1]||secMatch[2])*1000 : 500)});
      }

      // servo
      const servoPinMatch = s.match(/Ø§Ù„Ø¨Ù†\s*(\d+)/);
      const servoAngleMatch = s.match(/Ø²Ø§ÙˆÙŠØ©\s*(\d+)/) || s.match(/angle\s*(\d+)/);
      if (s.includes('Ø³ÙŠØ±ÙÙˆ') || s.includes('servo')) {
        intents.push({type:'servo', pin: servoPinMatch ? parseInt(servoPinMatch[1]) : 9, angle: servoAngleMatch ? parseInt(servoAngleMatch[1]) : 90});
      }

      // pwm brightness
      const pwmMatchVal = s.match(/(\d+)\s*(?:pwm|Ø³Ø·ÙˆØ¹|Ù‚ÙŠÙ…Ø©)/) || s.match(/Ø¥Ù„Ù‰\s*(\d+)\s*(?:pwm|Ø³Ø·ÙˆØ¹)/);
      if (s.includes('pwm') || s.includes('Ø³Ø·ÙˆØ¹')) {
        intents.push({type:'pwm', pin: pin || 5, value: pwmMatchVal ? parseInt(pwmMatchVal[1]) : 128});
      }

      // steer minimal commands
      return intents;
    }

    function generateCode(intents){
      // headers
      let includes = new Set();
      let setup = [];
      let loop = [];

      function ensurePinMode(pin, mode){
        const line = `pinMode(${pin}, ${mode});`;
        if (!setup.includes(line)) setup.push(line);
      }

      intents.forEach(intent=>{
        if (intent.type==='led'){
          ensurePinMode(intent.pin, 'OUTPUT');
          loop.push(`digitalWrite(${intent.pin}, ${intent.action==='on'?'HIGH':'LOW'});`);
        }
        if (intent.type==='delay'){
          loop.push(`delay(${intent.ms});`);
        }
        if (intent.type==='serial'){
          includes.add('serial');
          loop.push(`Serial.println("${intent.msg.replace(/"/g,'\\"')}");`);
        }
        if (intent.type==='analog'){
          includes.add('serial');
          loop.push(`int val = analogRead(${intent.pin});`);
          loop.push(`Serial.print("Analog ${intent.pin}: "); Serial.println(val);`);
          loop.push(`delay(${intent.interval});`);
        }
        if (intent.type==='servo'){
          includes.add('servo');
          setup.push(`myServo.attach(${intent.pin});`);
          loop.push(`myServo.write(${intent.angle});`);
        }
        if (intent.type==='pwm'){
          ensurePinMode(intent.pin, 'OUTPUT');
          loop.push(`analogWrite(${intent.pin}, ${Math.max(0, Math.min(255, intent.value))});`);
        }
      });

      // includes
      let top = [];
      if (includes.has('servo')) top.push('#include <Servo.h>\nServo myServo;');
      if (includes.has('serial')) setup.unshift('Serial.begin(9600);');

      // build sketch
      return `
${top.join('\n')}

void setup() {
  ${setup.join('\n  ') || '// Ù„Ø§ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª'}
}

void loop() {
  ${loop.join('\n  ') || '// Ù„Ø§ Ø£ÙˆØ§Ù…Ø± â€” Ø£Ø¶Ù ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ø«Ù… Ø§Ø¶ØºØ· ØªØ­ÙˆÙŠÙ„'}
}
`.trim();
    }

    document.getElementById('convert').addEventListener('click', ()=>{
      const text = arabicEl.value.trim();
      if(!text){ codeEl.textContent = '// Ø§ÙƒØªØ¨ Ø£Ù…Ø±Ù‹Ø§ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ø«Ù… Ø§Ø¶ØºØ· ØªØ­ÙˆÙŠÙ„'; return; }
      const intents = parseIntent(text);
      const code = generateCode(intents);
      codeEl.textContent = code;
    });

    document.getElementById('copy').addEventListener('click', ()=>{
      const code = codeEl.textContent;
      navigator.clipboard.writeText(code).then(()=> alert('ØªÙ… Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯'));
    });

    document.getElementById('download').addEventListener('click', ()=>{
      const name = (projEl.value.trim() || 'arduino_auto').replace(/[^a-zA-Z0-9_-]/g,'_');
      const blob = new Blob([codeEl.textContent], {type:'text/plain'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = name + '.ino';
      a.click();
      URL.revokeObjectURL(a.href);
    });
  </script>
</body>
</html>
